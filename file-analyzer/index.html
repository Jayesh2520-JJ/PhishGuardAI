<script>
    function analyzeFile() {
        const fileInput = document.getElementById('fileInput');
        const resultDiv = document.getElementById('result');
        const loadingContainer = document.getElementById('loadingContainer');
        const statusText = document.getElementById('statusText');
        const scanBar = document.getElementById('scanBar');
        const uploadTitle = document.getElementById('uploadTitle');

        // Check if a file was actually selected
        if (fileInput.files.length === 0) return;

        const file = fileInput.files[0];
        
        // 1. Reset UI and Start Animation immediately
        loadingContainer.style.display = 'flex';
        scanBar.style.display = 'block';
        resultDiv.style.display = 'none';
        uploadTitle.innerText = "Analyzing: " + file.name;
        statusText.innerText = "Initializing Scan...";

        // 2. Sequence through the analysis stages
        const stages = [
            "Calculating MD5 Hash...", 
            "Checking Heuristics...", 
            "Running Sandboxed Test...", 
            "Finalizing Report..."
        ];
        
        let stageIdx = 0;
        const statusInterval = setInterval(() => {
            if(stageIdx < stages.length) {
                statusText.innerText = stages[stageIdx];
                stageIdx++;
            }
        }, 700);

        // 3. Complete the analysis after 3 seconds
        setTimeout(() => {
            clearInterval(statusInterval);
            loadingContainer.style.display = 'none';
            scanBar.style.display = 'none';
            resultDiv.style.display = 'block';
            uploadTitle.innerText = "Click to upload file";

            // Logic to determine safety
            if (file.name.toLowerCase().endsWith('.exe')) {
                resultDiv.className = 'danger';
                resultDiv.innerHTML = `<strong>⚠️ Malicious File Detected!</strong><br>The file "${file.name}" is an executable and may contain harmful code.`;
            } else {
                resultDiv.className = 'safe';
                resultDiv.innerHTML = `<strong>✅ File is Safe</strong><br>"${file.name}" passed the security check. No threats found.`;
            }
            
            // Clear input so the same file can be uploaded again if needed
            fileInput.value = "";
        }, 3000); 
    }
</script>
